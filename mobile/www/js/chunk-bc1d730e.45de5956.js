(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bc1d730e"],{"0594":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"panel"},[n("div",{staticClass:"panel__inner",class:{padding:t.padding}},[t.title?n("div",{staticClass:"h1",domProps:{innerHTML:t._s(t.title)}}):t._e(),t.subtitle?n("div",{staticClass:"text",domProps:{innerHTML:t._s(t.subtitle)}}):t._e(),n("div",{staticClass:"panel__content",class:t.innerClass},[t._t("default")],2)])])},a=[],s={name:"panel_box",props:{padding:{type:Boolean,default:!0},title:String,subtitle:String,innerClass:String}},o=s,r=(n("99d2"),n("2877")),c=Object(r["a"])(o,i,a,!1,null,null,null);e["a"]=c.exports},"1b37":function(t,e,n){},"2e87":function(t,e,n){"use strict";var i=n("be7b"),a=n.n(i);a.a},"31bb":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"profile"},[n("profile"),n("email"),n("password"),n("social")],1)},a=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("panel_box",{attrs:{title:"Основная информация"}},[n("div",{staticClass:"profile-main"},[n("div",{staticClass:"profile-main__picture"},[n("p",{staticClass:"profile-main__text"},[t._v(" Фото профиля "+t._s(t.model.picture.error)+" ")]),n("div",{staticClass:"profile-main__userpic"},[n("div",{staticClass:"profile-main__userpic--add"},[n("icon",{attrs:{name:"plus"}}),n("input",{attrs:{type:"file"},on:{change:t.upload}})],1),n("div",{staticClass:"photo-fake",style:{backgroundImage:"url("+(t.model.picture.preview||t.model.picture.value)+")"}})]),n("p",{staticClass:"profile-main__info"},[t._v(" Будет отображаться на сайте и в личном кабинете. Вашему куратору будет проще найти вас в сообщениях. ")])]),n("div",{staticClass:"profile-main__form"},[n("div",{staticClass:"profile-main__container"},t._l(["name","last_name","middle_name"],(function(e){return n("input_box",t._b({key:e,model:{value:t.model[e].value,callback:function(n){t.$set(t.model[e],"value",n)},expression:"model[key].value"}},"input_box",t.model[e],!1))})),1),n("div",{staticClass:"profile-main__container"},[n("input_box",t._b({model:{value:t.model.phone.value,callback:function(e){t.$set(t.model.phone,"value",e)},expression:"model.phone.value"}},"input_box",t.model.phone,!1)),n("input_box",t._b({on:{change:function(e){return t.changeDate(e)}},model:{value:t.model.birthday.value,callback:function(e){t.$set(t.model.birthday,"value",e)},expression:"model.birthday.value"}},"input_box",t.model.birthday,!1)),n("p",{staticClass:"profile-main__info",domProps:{innerHTML:t._s("* Указание даты рождения позволит вам получать скидки в дни родения")}})],1)])]),n("div",{staticClass:"profile-main__btn"},[n("notification",{attrs:{notification:t.notification}}),n("button_box",{attrs:{performing:t.isPerforming,title:"Сохранить"},on:{click:function(e){return t.saveData()}}})],1)])},o=[],r=(n("d81d"),n("a9e3"),n("ac1f"),n("1276"),n("b85c")),c=(n("96cf"),n("1da1")),l=n("5530"),u=n("0594"),f=n("75be"),p=n("654c"),m=n("1825"),d=n("34d8"),h=n("2f62"),v={name:"profile",components:{panel_box:u["a"],notification:f["a"]},mixins:[p["a"],m["a"]],data:function(){return{isLoading:!0,isPerforming:!1,errorLog:[],notification:{status:!0,message:""},model:{picture:{value:"",preview:null,error:""},name:{value:"",label:"Имя",error:"",required:!0},last_name:{value:"",label:"Фамилия"},middle_name:{value:"",label:"Очество"},phone:{value:"",label:"Телефон"},birthday:{type:"date",value:"",label:"Дата рождения",mask:"####-##-##",error:"",validate:[{function:function(t){var e=t.split("-").map((function(t){return Number(t)}));return e[1]<=12&&e[2]<=31},title:"Введите дату в формате ГГГГ-ММ-ДД"}]}}}},computed:Object(l["a"])({},Object(h["b"])({user:function(t){return t.base.user}})),methods:{saveData:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.validate()){t.next=6;break}return this.isPerforming=!0,this.notification.message="",t.next=5,d["a"].updateUser(this.entity).then((function(t){console.log(t),e.$store.commit("base/SET_USER",t.data),e.entity=t.data,e.notification.status=!0,e.notification.message="Данные успешно обновлены"})).catch((function(t){console.log(t),e.notification.status=!1,e.notification.message="Произошла ошибка при обновлении. Код ошибки #".concat(t.status)}));case 5:this.isPerforming=!1;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),changeDate:function(t){t.length<10&&(this.model.birthday.value="")},upload:function(t){var e=this;t.preventDefault();var n,i=t.target.files,a=Object(r["a"])(i);try{var s=function(){var i=n.value,a=new FileReader;a.readAsDataURL(i),i.size>=20971520?e.model.picture.error="Максимальный размер файла - 20мб":a.onload=function(n){e.model.picture.value=i,e.model.picture.preview=n.target.result,t.target.value=""}};for(a.s();!(n=a.n()).done;)s()}catch(o){a.e(o)}finally{a.f()}}},watch:{user:function(t){this.entity=t}},created:function(){this.entity=this.user}},_=v,b=(n("2e87"),n("2877")),g=Object(b["a"])(_,s,o,!1,null,null,null),w=g.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("panel_box",{attrs:{title:t.title,subtitle:t.subtitle}},[n("div",[n("notification",{attrs:{notification:t.notification}}),t._l(t.model,(function(e,i){return n("input_box",t._b({key:i,model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"field.value"}},"input_box",e,!1))})),n("button_box",{attrs:{performing:t.isPerforming,title:"Сохранить"},on:{click:t.saveData}})],2)])},k=[],y={name:"email",components:{notification:f["a"],panel_box:u["a"]},mixins:[p["a"],m["a"]],data:function(){return{isPerforming:!1,notification:{message:"",status:!0},title:"Электронная почта",subtitle:"Будет использоваться для входа в личный кабинет",model:{email:{value:"",label:"Новая эл. почта",required:!0,empty_error:"Введите эл. почту",error:""},password:{value:"",label:"Ваш пароль",type:"password",required:!0,empty_error:"Введите пароль",error:""}}}},methods:{saveData:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.validate()||!this.customValidate()){t.next=6;break}return this.isPerforming=!0,this.notification.message="",t.next=5,d["a"].updateEmail(this.entity).then((function(){e.notification.status=!0,e.notification.message="Эл. почта успешно изменена"})).catch((function(t){if(console.log(t),400===t.status){var n=t.error_code;40002===n?e.model.email.error="Эл. почта занята другим аккаунтом":40001===n?e.model.password.error="Неправильный пароль":e.model.email.error="Произошла неопознанная ошибка"}else e.notification.message=!1,e.notification.title="Произошла ошибка. Код: ".concat(t.status)}));case 5:this.isPerforming=!1;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),customValidate:function(){var t=!1;return this.$store.state.base.user.email===this.entity.email&&(this.entity.email.value="Это ваша текущая почта",t=!0),!t}}},C=y,O=Object(b["a"])(C,x,k,!1,null,null,null),j=O.exports,P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("panel_box",{attrs:{title:"Пароль"}},[n("div",{staticClass:"profile-pass"},[n("div",[t._l(t.model,(function(e,i){return n("input_box",t._b({key:i,model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"field.value"}},"input_box",e,!1))})),n("notification",{attrs:{notification:t.notification}}),n("button_box",{attrs:{performing:t.isPerforming},on:{click:t.saveData}},[t._v(" Обновить пароль ")])],2),n("div",{staticClass:"form-pass__popup"},[n("ul",{staticClass:"profile-pass-valid",class:{opened:t.model.new_password.error&&t.model.new_password.value.length>0}},[n("li",{staticClass:"profile-pass-valid__item"},[t._v("Убедитесь, что не включена кнопка "),n("span",[t._v("Caps Lock")])]),n("li",{staticClass:"profile-pass-valid__item"},[t._v("Пароль должен быть не менее 6 символов в длину")]),n("li",{staticClass:"profile-pass-valid__item"},[t._v("Хороший пароль должен состоять из букв и цифр")])])])])])},S=[],$={name:"password",components:{panel_box:u["a"],notification:f["a"]},mixins:[p["a"],m["a"]],data:function(){return{isPerforming:!1,pass_valid_pop:!1,notification:{status:!0,message:null},model:{old_password:{value:"",type:"password",error:"",required:!0,label:"Старый пароль"},new_password:{value:"",error:"",required:!0,validate:[{regexp:/^.{6,}$/,title:"Пароль меньше 6 символов"},{regexp:/[a-zA-Z]+/i,title:"Должна быть хотя бы 1 буква"},{regexp:/[0-9]+/i,title:"Должно быть хотя бы 1 число"}],type:"password",label:"Новый пароль"},repeat_password:{value:"",error:"",ignore:!0,required:!0,type:"password",label:"Повторите пароль"}}}},methods:{saveData:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.validate()&&this.customValidate()&&(this.isPerforming=!0,this.notification.message="",d["a"].updatePassword(this.entity).then((function(){e.notification.status=!0,e.notification.message="Пароль успешно изменен."})).catch((function(t){if(400===t.status){console.log(t);var n=t.error_code;e.model.old_password.error=40001===n?"Неправильный пароль":"Произошла неизвестная ошибка"}else e.notification.status=!1,e.notification.message="Произошла неизвестная ошибка. Код: ".concat(t.status)})),this.isPerforming=!1);case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),customValidate:function(){var t=!1;return t||this.model.new_password.value===this.model.repeat_password.value||(t=!0,this.model.repeat_password.error="Пароли не совпадают"),this.model.new_password.length<0&&(t=!0,this.pass_valid_pop=!0),!t}}},R=$,E=(n("7e43"),Object(b["a"])(R,P,S,!1,null,null,null)),V=E.exports,D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("panel_box",{attrs:{title:"Объединение аккаунтов"}},[n("notification",{attrs:{notification:t.notification}}),n("div",{staticClass:"profile-socials"},t._l(t.socials,(function(e,i){return n("div",{key:i,staticClass:"profile-social-item"},[n("div",{staticClass:"profile-social__icon",class:i,style:{backgroundImage:"url("+t.basePath+"svg/"+e.image+")"},on:{click:function(e){t.user[i].auth?t.unconnectSocial(i):t.connectSocial(i)}}}),n("input_box",{attrs:{value:t.user[i].auth?t.user[i].name+" "+t.user[i].last_name:"Не подключен",disabled:!0,label:e.label,icon:t.user[i].auth?"close":"arrow-right"},on:{click:function(e){t.user[i].auth?t.unconnectSocial(i):t.connectSocial(i)}}}),n("div",{staticClass:"profile-social__btn",domProps:{textContent:t._s(t.user[i].auth?"Отключить":"Подключить")},on:{click:function(e){t.user[i].auth?t.unconnectSocial(i):t.connectSocial(i)}}})],1)})),0)],1)},F=[],L=(n("99af"),n("c975"),n("b64b"),n("d3b7"),n("9911"),n("ade3")),q={name:"social",components:{panel_box:u["a"],notification:f["a"]},data:function(){var t=this;return{modal:{show:!1,html:""},notification:{status:!1,message:null},socials:{vk:{app_id:7716381,label:"vk.com",title:"Вконтакте",performing:!1,connect:this.connectVK,unconnect:this.unconnectVK,image:"vk-white.svg",icon:"arrow-right",api:{auth:function(){return new Promise((function(e,n){t.notification.message=null,VK.Auth.login(function(){var i=Object(c["a"])(regeneratorRuntime.mark((function i(a){var s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:"connected"===a.status?(s={name:a.session.user.first_name,last_name:a.session.user.last_name,social_type:"VKontakte",user_id:t.user.id,social_id:a.session.user.id},e(s)):n(a);case 1:case"end":return i.stop()}}),i)})));return function(t){return i.apply(this,arguments)}}(),4194304)}))},check:function(t){return new Promise((function(e,n){d["a"].checkVK(t).then((function(t){console.log(t),t.data.state?n(t.data):e(t.data)})).catch((function(t){console.log(t),n(t)}))}))},link:function(t){return d["a"].linkVK(t)},unlink:function(){return d["a"].unlinkVK()}}},fb:{app_id:398206061505133,label:"facebook.com",title:"Facebook",performing:!1,connect:this.connectFB,unconnect:this.unconnectFB,image:"fb-white.svg",api:{auth:function(){return new Promise((function(e,n){FB.login((function(i){i.authResponse?FB.api("/me?fields=email,first_name,last_name",(function(n){var i={name:n.first_name||"",last_name:n.last_name||"",user_id:t.user.id,social_id:n.id,email:n.email,social_type:"Facebook"};e(i)})):n(i)}),{scope:"email"})}))},check:function(t){return new Promise((function(e,n){d["a"].checkFB(t).then((function(t){t.data.state?n(t.data):e(t.data)})).catch((function(t){n(t)}))}))},link:function(t){return d["a"].linkFB(t)},unlink:function(){return d["a"].unlinkVK()}}}}}},computed:Object(l["a"])({},Object(h["b"])({user:function(t){return t.base.user}})),methods:{connectSocial:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e){var n,i,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(Object.keys(this.socials).indexOf(e)<0)){t.next=2;break}return t.abrupt("return");case 2:return this.notification.message=null,this.notification.status=0,n=e,e=this.socials[e],t.next=8,e.api.auth().catch((function(t){throw a.notification.message="Вы не прошли авторизацию ".concat(e.title),t}));case 8:return i=t.sent,t.next=11,e.api.check(i.social_id).catch((function(t){throw t.email?a.notification.message="Учетная запись ".concat(e.title," занята аккаунтом ").concat(t.email):a.notification.message="Произошла ошибка при проверке. Код ошибки ".concat(t.status),t}));case 11:return t.next=13,e.api.link(i).catch((function(t){throw 409===t.status?a.notification.message="Произошел конфликт при привязке.":a.notification.message="Произошла ошибка при привязке. Код ошибки ".concat(t.status),t}));case 13:this.$store.commit("base/SET_USER",Object(L["a"])({},n,Object(l["a"])({auth:!0},i))),this.notification.status=!0,this.notification.message="Аккаунт ".concat(e.title," успешно привязан");case 16:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),unconnectSocial:function(t){var e=this;if(!(Object.keys(this.socials).indexOf(t)<0)){var n=t;t=this.socials[n],this.notification.message=null,t.api.unlink().then((function(){e.notification.status=!0,e.notification.message="Аккаунт ".concat(t.title," успешно отвязан"),e.$store.commit("base/SET_USER",Object(L["a"])({},n,{auth:!1}))})).catch((function(t){e.notification.status=!1,e.notification.message="Произошла ошибка при отвязке. Код ошибки ".concat(t.status)}))}}}},K=q,B=(n("7efe"),Object(b["a"])(K,D,F,!1,null,null,null)),T=B.exports,U={name:"main.vue",components:{profile:w,email:j,password:V,social:T}},H=U,M=(n("6585"),Object(b["a"])(H,i,a,!1,null,null,null));e["default"]=M.exports},"5adc":function(t,e,n){},6585:function(t,e,n){"use strict";var i=n("5adc"),a=n.n(i);a.a},"68c8":function(t,e,n){},"75be":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.notification.message?n("div",{staticClass:"notification",style:{color:t.notification.status?"green":"red"},domProps:{innerHTML:t._s(t.notification.message)}}):t._e()},a=[],s={name:"notification",props:{notification:{type:Object,required:!0}}},o=s,r=n("2877"),c=Object(r["a"])(o,i,a,!1,null,null,null);e["a"]=c.exports},"7e43":function(t,e,n){"use strict";var i=n("68c8"),a=n.n(i);a.a},"7efe":function(t,e,n){"use strict";var i=n("a205"),a=n.n(i);a.a},"857a":function(t,e,n){var i=n("1d80"),a=/"/g;t.exports=function(t,e,n,s){var o=String(i(t)),r="<"+e;return""!==n&&(r+=" "+n+'="'+String(s).replace(a,"&quot;")+'"'),r+">"+o+"</"+e+">"}},9911:function(t,e,n){"use strict";var i=n("23e7"),a=n("857a"),s=n("af03");i({target:"String",proto:!0,forced:s("link")},{link:function(t){return a(this,"a","href",t)}})},"99d2":function(t,e,n){"use strict";var i=n("1b37"),a=n.n(i);a.a},a205:function(t,e,n){},af03:function(t,e,n){var i=n("d039");t.exports=function(t){return i((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},be7b:function(t,e,n){}}]);
//# sourceMappingURL=chunk-bc1d730e.45de5956.js.map